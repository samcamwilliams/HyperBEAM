<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Module dev_p4</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<hr>

<h1>Module dev_p4</h1>
<ul class="index"><li><a href="#description">Description</a></li><li><a href="#index">Function Index</a></li><li><a href="#functions">Function Details</a></li></ul>The HyperBEAM core payment ledger.


<h2><a name="description">Description</a></h2><p>The HyperBEAM core payment ledger. This module allows the operator to   
specify another device that can act as a pricing mechanism for transactions   
on the node, as well as orchestrating a payment ledger to calculate whether   
the node should fulfil services for users.</p>
  
   <p>The device requires the following node message settings in order to function:</p>
  
   <p>- <code>p4_pricing_device</code>: The device that will estimate the cost of a request.
   - <code>p4_ledger_device</code>: The device that will act as a payment ledger.</p>
  
   The pricing device should implement the following keys:
   <pre>               GET /estimate?type=pre|post&amp;body=[...]&amp;request=RequestMessage
               GET /price?type=pre|post&amp;body=[...]&amp;request=RequestMessage</pre>
  
   <p>The <code>body</code> key is used to pass either the request or response messages to the
   device. The <code>type</code> key is used to specify whether the inquiry is for a request
   (pre) or a response (post) object. Requests carry lists of messages that will
   be executed, while responses carry the results of the execution. The <code>price</code>
   key may return <code>infinity</code> if the node will not serve a user under any
   circumstances. Else, the value returned by the <code>price</code> key will be passed to
   the ledger device as the <code>amount</code> key.</p>
  
   The ledger device should implement the following keys:
   <pre>               POST /credit?message=PaymentMessage&amp;request=RequestMessage
               POST /debit?amount=PriceMessage&amp;type=pre|post&amp;request=RequestMessage</pre>
  
   The <code>type</code> key is optional and defaults to <code>pre</code>. If <code>type</code> is set to <code>post</code>,
   the debit must be applied to the ledger, whereas the <code>pre</code> type is used to
   check whether the debit would succeed before execution.
<h2><a name="index">Function Index</a></h2>
<table width="100%" border="1" cellspacing="0" cellpadding="2" summary="function index"><tr><td valign="top"><a href="#balance-3">balance/3</a></td><td>Get the balance of a user in the ledger.</td></tr>
<tr><td valign="top"><a href="#postprocess-3">postprocess/3</a></td><td>Postprocess the request after it has been fulfilled.</td></tr>
<tr><td valign="top"><a href="#preprocess-3">preprocess/3</a></td><td>Estimate the cost of a transaction and decide whether to proceed with
  a request.</td></tr>
</table>

<h2><a name="functions">Function Details</a></h2>

<h3 class="function"><a name="balance-3">balance/3</a></h3>
<div class="spec">
<p><code>balance(X1, Req, NodeMsg) -&gt; any()</code></p>
<p> </p>
</div><p>Get the balance of a user in the ledger.</p>

<h3 class="function"><a name="postprocess-3">postprocess/3</a></h3>
<div class="spec">
<p><code>postprocess(State, RawResponse, NodeMsg) -&gt; any()</code></p>
<p> </p>
</div><p>Postprocess the request after it has been fulfilled.</p>

<h3 class="function"><a name="preprocess-3">preprocess/3</a></h3>
<div class="spec">
<p><code>preprocess(State, Raw, NodeMsg) -&gt; any()</code></p>
<p> </p>
</div><p>Estimate the cost of a transaction and decide whether to proceed with
  a request. The default behavior if <code>pricing_device</code> or <code>p4_balances</code> are
  not set is to proceed, so it is important that a user initialize them.</p>
<hr>

<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc</i></p>
</body>
</html>
