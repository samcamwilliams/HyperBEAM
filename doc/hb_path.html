<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Module hb_path</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<hr>

<h1>Module hb_path</h1>
<ul class="index"><li><a href="#description">Description</a></li><li><a href="#index">Function Index</a></li><li><a href="#functions">Function Details</a></li></ul>This module provides utilities for manipulating the paths of a
   message: Its request path (referred to in messages as just the <code>Path</code>), and   
its HashPath.


<h2><a name="description">Description</a></h2><p>This module provides utilities for manipulating the paths of a
   message: Its request path (referred to in messages as just the <code>Path</code>), and   
its HashPath.</p>
  
   <p>A HashPath is a rolling Merkle list of the messages that have been applied   
in order to generate a given message. Because applied messages can   
themselves be the result of message applications with the Converge Protocol,   
the HashPath can be thought of as the tree of messages that represent the   
history of a given message. The initial message on a HashPath is referred to   
by its ID and serves as its user-generated 'root'.</p>
  
   Specifically, the HashPath can be generated by hashing the previous HashPath
   and the current message. This means that each message in the HashPath is
   dependent on all previous messages.
   <pre>       Msg1.HashPath = Msg1.ID
       Msg3.HashPath = Msg1.Hash(Msg1.HashPath, Msg2.ID)
       Msg3.{...} = Converge.apply(Msg1, Msg2)
       ...</pre>
  
   <p>A message's ID itself includes its HashPath, leading to the mixing of   
a Msg2's merkle list into the resulting Msg3's HashPath. This allows a single   
message to represent a history _tree_ of all of the messages that were   
applied to generate it -- rather than just a linear history.</p>
  
   A message may also specify its own algorithm for generating its HashPath,
   which allows for custom logic to be used for representing the history of a
   message. When Msg2's are applied to a Msg1, the resulting Msg3's HashPath
   will be generated according to Msg1's algorithm choice.
<h2><a name="index">Function Index</a></h2>
<table width="100%" border="1" cellspacing="0" cellpadding="2" summary="function index"><tr><td valign="top"><a href="#from_message-2">from_message/2</a></td><td>Extract the request path or hashpath from a message.</td></tr>
<tr><td valign="top"><a href="#hashpath-2">hashpath/2</a></td><td>Add an ID of a Msg2 to the HashPath of another message.</td></tr>
<tr><td valign="top"><a href="#hashpath-3">hashpath/3</a></td><td></td></tr>
<tr><td valign="top"><a href="#hashpath-4">hashpath/4</a></td><td></td></tr>
<tr><td valign="top"><a href="#hashpath_alg-1">hashpath_alg/1</a></td><td>Get the hashpath function for a message from its HashPath-Alg.</td></tr>
<tr><td valign="top"><a href="#hd-2">hd/2</a></td><td>Extract the first key from a <code>Message2</code>'s <code>Path</code> field.</td></tr>
<tr><td valign="top"><a href="#matches-2">matches/2</a></td><td>Check if two keys match.</td></tr>
<tr><td valign="top"><a href="#normalize-1">normalize/1</a></td><td>Normalize a path to a binary, removing the leading slash if present.</td></tr>
<tr><td valign="top"><a href="#pop_request-2">pop_request/2</a></td><td>Pop the next element from a request path or path list.</td></tr>
<tr><td valign="top"><a href="#priv_remaining-2">priv_remaining/2</a></td><td>Return the <code>Remaining-Path</code> of a message, from its hidden <code>Converge</code>
  key.</td></tr>
<tr><td valign="top"><a href="#priv_store_remaining-2">priv_store_remaining/2</a></td><td>Store the remaining path of a message in its hidden <code>Converge</code> key.</td></tr>
<tr><td valign="top"><a href="#push_request-2">push_request/2</a></td><td>Add a message to the head (next to execute) of a request path.</td></tr>
<tr><td valign="top"><a href="#queue_request-2">queue_request/2</a></td><td>Queue a message at the back of a request path.</td></tr>
<tr><td valign="top"><a href="#regex_matches-2">regex_matches/2</a></td><td>Check if two keys match using regex.</td></tr>
<tr><td valign="top"><a href="#term_to_path_parts-1">term_to_path_parts/1</a></td><td>Convert a term into an executable path.</td></tr>
<tr><td valign="top"><a href="#term_to_path_parts-2">term_to_path_parts/2</a></td><td></td></tr>
<tr><td valign="top"><a href="#tl-2">tl/2</a></td><td>Return the message without its first path element.</td></tr>
<tr><td valign="top"><a href="#to_binary-1">to_binary/1</a></td><td>Convert a path of any form to a binary.</td></tr>
<tr><td valign="top"><a href="#verify_hashpath-2">verify_hashpath/2</a></td><td>Verify the HashPath of a message, given a list of messages that
   represent its history.</td></tr>
</table>

<h2><a name="functions">Function Details</a></h2>

<h3 class="function"><a name="from_message-2">from_message/2</a></h3>
<div class="spec">
<p><code>from_message(X1, Msg) -&gt; any()</code></p>
<p> </p>
</div><p>Extract the request path or hashpath from a message. We do not use
  Converge for this resolution because this function is called from inside Converge
  itself. This imparts a requirement: the message's device must store a
  viable hashpath and path in its Erlang map at all times, unless the message
  is directly from a user (in which case paths and hashpaths will not have
  been assigned yet).</p>

<h3 class="function"><a name="hashpath-2">hashpath/2</a></h3>
<div class="spec">
<p><code>hashpath(Bin, Opts) -&gt; any()</code></p>
<p> </p>
</div><p>Add an ID of a Msg2 to the HashPath of another message.</p>

<h3 class="function"><a name="hashpath-3">hashpath/3</a></h3>
<div class="spec">
<p><code>hashpath(Msg1, Msg2, Opts) -&gt; any()</code></p>
<p> </p>
</div>

<h3 class="function"><a name="hashpath-4">hashpath/4</a></h3>
<div class="spec">
<p><code>hashpath(Msg1, Msg2, HashpathAlg, Opts) -&gt; any()</code></p>
<p> </p>
</div>

<h3 class="function"><a name="hashpath_alg-1">hashpath_alg/1</a></h3>
<div class="spec">
<p><code>hashpath_alg(Msg) -&gt; any()</code></p>
<p> </p>
</div><p>Get the hashpath function for a message from its HashPath-Alg.
   If no hashpath algorithm is specified, the protocol defaults to
   <code>sha-256-chain</code>.</p>

<h3 class="function"><a name="hd-2">hd/2</a></h3>
<div class="spec">
<p><code>hd(Msg2, Opts) -&gt; any()</code></p>
<p> </p>
</div><p>Extract the first key from a <code>Message2</code>'s <code>Path</code> field.
  Note: This function uses the <code>dev_message:get/2</code> function, rather than
  a generic call as the path should always be an explicit key in the message.</p>

<h3 class="function"><a name="matches-2">matches/2</a></h3>
<div class="spec">
<p><code>matches(Key1, Key2) -&gt; any()</code></p>
<p> </p>
</div><p>Check if two keys match.</p>

<h3 class="function"><a name="normalize-1">normalize/1</a></h3>
<div class="spec">
<p><code>normalize(Path) -&gt; any()</code></p>
<p> </p>
</div><p>Normalize a path to a binary, removing the leading slash if present.</p>

<h3 class="function"><a name="pop_request-2">pop_request/2</a></h3>
<div class="spec">
<p><code>pop_request(Msg, Opts) -&gt; any()</code></p>
<p> </p>
</div><p>Pop the next element from a request path or path list.</p>

<h3 class="function"><a name="priv_remaining-2">priv_remaining/2</a></h3>
<div class="spec">
<p><code>priv_remaining(Msg, Opts) -&gt; any()</code></p>
<p> </p>
</div><p>Return the <code>Remaining-Path</code> of a message, from its hidden <code>Converge</code>
  key. Does not use the <code>get</code> or set <code>hb_private</code> functions, such that it
  can be safely used inside the main Converge resolve function.</p>

<h3 class="function"><a name="priv_store_remaining-2">priv_store_remaining/2</a></h3>
<div class="spec">
<p><code>priv_store_remaining(Msg, RemainingPath) -&gt; any()</code></p>
<p> </p>
</div><p>Store the remaining path of a message in its hidden <code>Converge</code> key.</p>

<h3 class="function"><a name="push_request-2">push_request/2</a></h3>
<div class="spec">
<p><code>push_request(Msg, Path) -&gt; any()</code></p>
<p> </p>
</div><p>Add a message to the head (next to execute) of a request path.</p>

<h3 class="function"><a name="queue_request-2">queue_request/2</a></h3>
<div class="spec">
<p><code>queue_request(Msg, Path) -&gt; any()</code></p>
<p> </p>
</div><p>Queue a message at the back of a request path. <code>path</code> is the only
   key that we cannot use dev_message's <code>set/3</code> function for (as it expects
   the compute path to be there), so we use <code>maps:put/3</code> instead.</p>

<h3 class="function"><a name="regex_matches-2">regex_matches/2</a></h3>
<div class="spec">
<p><code>regex_matches(Path1, Path2) -&gt; any()</code></p>
<p> </p>
</div><p>Check if two keys match using regex.</p>

<h3 class="function"><a name="term_to_path_parts-1">term_to_path_parts/1</a></h3>
<div class="spec">
<p><code>term_to_path_parts(Path) -&gt; any()</code></p>
<p> </p>
</div><p>Convert a term into an executable path. Supports binaries, lists, and
  atoms. Notably, it does not support strings as lists of characters.</p>

<h3 class="function"><a name="term_to_path_parts-2">term_to_path_parts/2</a></h3>
<div class="spec">
<p><code>term_to_path_parts(Binary, Opts) -&gt; any()</code></p>
<p> </p>
</div>

<h3 class="function"><a name="tl-2">tl/2</a></h3>
<div class="spec">
<p><code>tl(Msg2, Opts) -&gt; any()</code></p>
<p> </p>
</div><p>Return the message without its first path element. Note that this
  is the only transformation in Converge that does _not_ make a log of its
  transformation. Subsequently, the message's IDs will not be verifiable
  after executing this transformation.
  This may or may not be the mainnet behavior we want.</p>

<h3 class="function"><a name="to_binary-1">to_binary/1</a></h3>
<div class="spec">
<p><code>to_binary(Path) -&gt; any()</code></p>
<p> </p>
</div><p>Convert a path of any form to a binary.</p>

<h3 class="function"><a name="verify_hashpath-2">verify_hashpath/2</a></h3>
<div class="spec">
<p><code>verify_hashpath(Rest, Opts) -&gt; any()</code></p>
<p> </p>
</div><p>Verify the HashPath of a message, given a list of messages that
   represent its history.</p>
<hr>

<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc</i></p>
</body>
</html>
